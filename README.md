# Работа с загрузчиком #
1. Попасть систему без пароля несколькими способами;<br/>
2. Установить систему с LVM, после чего перименовать VG;<br/>
3. Добавить модуль в initrd.<br/>
### Исходные данные ###
&ensp;&ensp;ПК на Linux c 8 ГБ ОЗУ или виртуальная машина (ВМ) с включенной Nested Virtualization.<br/>
&ensp;&ensp;Предварительно установленное и настроенное ПО:<br/>
&ensp;&ensp;&ensp;Hashicorp Vagrant (https://www.vagrantup.com/downloads);<br/>
&ensp;&ensp;&ensp;Oracle VirtualBox (https://www.virtualbox.org/wiki/Linux_Downloads).<br/>
&ensp;&ensp;&ensp;Все действия проводились с использованием Vagrant 2.4.0, VirtualBox 7.0.14 и образа<br/> 
&ensp;&ensp;CentOS 7 версии 1804_2
### Ход решения ###
### Попасть в систему несколькими способами ###
&ensp;&ensp;Для выполнения задания необходимо сконфигурировать Vagrant таким образом, чтобы после старта ВМ<br/>
открывалось окно Virtual Box с работающей системой. Для этого в блок provider Vagrant-файла добавить строку<br/> 
vm.gui = true. После старта ВМ в меню GRUB, отображающем строки вариантов загрузки системы, необходимо <br/>
нажать "e" (edit) для того, чтобы отредактировать параметры загрузки. <br/>

- Способ № 1<br/>
&ensp;&ensp; В конце строки, начинающейся с linux 16, удалить параметры rhgb и quiet, затем добавить rd.break<br/>
(переход в командную строку в конце обработки initramfs) и enforcing=0 (загрузка SELinux в permissive режиме).<br/>
Для запуска системы с текущей конфигурацией необходимо нажать ctrl+x.<br/>
&ensp;&ensp;После загрузки консоли, необходимо перемонтировать корневую фаловую систему в режим чтения-записи<br/>
войти в корневую файловую систему, задать пароль root, обновить параметры системы SELinux и перезагрузить систему:<br/>
```shell
mount -o remount,rw /sysroot
chroot /sysroot
passwd root
...
touch /.autoreleable
exit
```
&ensp;&ensp;Чтобы осуществлять вход в систему, необходимо восстановить контекст безопасности файла /etc/shadow.<br/>
Для этого необходимо при загрузке снова перевести SELinux в режим permissive (enforcing=0) и далее выполнить<br/>
ряд команд:
```shell
restorecon /etc/shadow
setenforce 1
```
- Способ № 2<br/>
&ensp;&ensp; В конце строки, начинающейся с linux 16, удалить параметры rhgb и quiet, затем вместо параметра ro<br/>
указать,rw (монтирование /sysroot в режиме чтение-запись) и после него добавить init=/sysroot/bin/sh (запуск консоли).<br/>
Для запуска системы с текущей конфигурацией необходимо нажать ctrl+x.<br/>
&ensp;&ensp;После загрузки консоли, необходимо войти в корневую файловую систему, задать пароль root, обновить<br/>
параметры системы SELinux и перезагрузить систему:<br/>
```shell
chroot /sysroot
passwd root
...
touch /.autoreleable
exit
```
&ensp;&ensp;Чтобы осуществлять вход в систему, необходимо восстановить контекст безопасности файла /etc/shadow.<br/>
Для этого необходимо при загрузке снова перевести SELinux в режим permissive (enforcing=0) и далее выполнить<br/>
ряд команд:
```shell
restorecon /etc/shadow
setenforce 1
```

&ensp;&ensp;Стоит отметить что, способ с добавлением в параметры загрузки только init=/bin/sh пригоден для debian-like <br/>
дистрибутивов (работатет с Ubuntu 22.04), и, возможно, других. Использование данного способа для запуска CentOS <br/>
вызывало сбой в работе ядра (kernel panic).<br/>
&ensp;&ensp;Перечисленные способы в целом идентичны, отличия заключаются в режимах монтирования корневой файловой системы. <br/>
Если используется режим ro, то после загрузки консоли, необходимо перемонтировать корень в режим rw, для того, чтобы все<br/>
все планируемые изменения были применены. При использовании CentOS необходимо учитывать аспекты, связанные с работой SELinux.
